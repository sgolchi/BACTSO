{
    "collab_server" : "",
    "contents" : "M = 2000\n\nP_a = c(.35, .4)\nP_b = c(.4, .4)\np = c(0, 0, .25, .25)\npmean = c(.5, .75, .5, .75)\n\ncases = cbind(rep(P_a, length(p)), expand.grid(P_b, p), rep(pmean, each = length(P_b)))\nnames(cases) = c('P_a', 'P_b', 'p', 'pmean')\n\n\nlibrary(parallel)\nsim0 = mcmapply(trial_add_RAR_sim, P_a = cases$P_a, P_b = cases$P_b, p = cases$p, pmean0 = cases$pmean, \n                MoreArgs = list(PF_var = 1, np = 5, nadapt = 6, M = M, pvar = 0.16), mc.cores = 4)\n\nsim_df = cbind(unlist_df(t(sim0)), mefa:::rep.data.frame(cases, each = M))\nsim_df$model = rep(\"FA_unbiased\", nrow(sim_df))\nsim_df$model[sim_df$pmean == .5]  = \"FA_biased_0.5\"\nsim_df$model[sim_df$pmean == .75]  = \"FA_biased_0.75\"\nfact = paste('P_A', '=', sim_df$P_a, 'P_B', '=', sim_df$P_b)\nsim_df$fact = fact\nsim_df0 = sim_df\n#sim_df0$pmean = NULL\n\n# sdf = sim_df %>%\n#   group_by(fact, p, model) %>%\n#   summarise(EFP = mean(FP))\n# plot0 = ggplot(sdf, aes(x = fact, y = EFP, fill = model )) +\n#   geom_bar(stat = \"identity\", position = position_dodge(), color = 'grey40', width = 0.5) + \n#   xlab(\"\") + ylab('EPF') + scale_fill_brewer(palette=\"Set2\") + facet_grid(p ~ .)\n\n########################################################\n# P_a = c(.35, .4)\n# P_b = c(.4, .4)\n# p = c(.5, .75, 1)\n# \n# \n# cases = cbind(rep(P_a, length(p)), expand.grid(P_b, p))\n# names(cases) = c('P_a', 'P_b', 'p')\n\n#library(parallel)\nsim1 = mcmapply(trial_add_full_sim, P_a = cases$P_a, P_b = cases$P_b, p = cases$p, pmean0 = cases$pmean,\n                MoreArgs = list(PF_var = 1, np = 5, nadapt = 6, M = M), mc.cores = 4)\n\nsim_df1 = cbind(unlist_df(t(sim1)), mefa:::rep.data.frame(cases, each = M))\nsim_df1$model = \"FullA\"\nfact = paste('P_A', '=', sim_df1$P_a, 'P_B', '=', sim_df1$P_b)\nsim_df1$fact = fact\n########################################\n# P_a = c(.35, .4)\n# P_b = c(.4, .4)\n# p = c(.5, .75, 1)\n# \n# cases = cbind(rep(P_a, length(p)), expand.grid(P_b, p))\n# names(cases) = c('P_a', 'P_b', 'p')\n\n#library(parallel)\nsim2 = mcmapply(trial_std_RAR_sim, P_a = cases$P_a, P_b = cases$P_b, p = cases$p, pmean0 = cases$pmean,\n                MoreArgs = list(PF_var = 1, np = 5, nadapt = 6, M = M), mc.cores = 4)\n\nsim_df2 = cbind(unlist_df(t(sim2)), mefa:::rep.data.frame(cases, each = M))\nsim_df2$model = \"Conventional\"\nfact = paste('P_A', '=', sim_df2$P_a, 'P_B', '=', sim_df2$P_b)\nsim_df2$fact = fact\n\nsim_df = rbind(sim_df0, sim_df1, sim_df2)\nsave(sim_df, file = \"extreme_results_1.RData\")\n\nload(\"extreme_results_1.RData\")\nsdf = sim_df %>%\n  group_by(fact, p, model) %>%\n  summarise(EFP = mean(FP), MSE_a = sqrt(mean(MSE_a0)), MSE_b = sqrt(mean(MSE_b0)), MSE_ab = sqrt(mean(MSE_ab0)),\n            bias_a = mean(bias_a), bias_b = mean(bias_b), bias_ab = mean(bias_ab),\n            ESS = mean(RN))\nnames(sdf)[names(sdf) == \"p\"] = \"f\"\nplot0 = ggplot(sdf, aes(x = fact, y = EFP, fill = model )) +\n  geom_bar(stat = \"identity\", position = position_dodge(), color = 'grey40', width = 0.5) + \n  xlab(\"\") + ylab('EPF') + scale_fill_brewer(palette=\"Set2\") + facet_grid(f ~ ., labeller = label_both)\nplot1 = ggplot(sdf, aes(x = fact, y = MSE_a, fill = model )) +\n  geom_bar(stat = \"identity\", position = position_dodge(), color = 'grey40', width = 0.5) + \n  xlab(\"\") + ylab('RMSE for A') + scale_fill_brewer(palette=\"Set2\") + facet_grid(f ~ ., labeller = label_both)\nplot2 = ggplot(sdf, aes(x = fact, y = MSE_b, fill = model )) +\n  geom_bar(stat = \"identity\", position = position_dodge(), color = 'grey40', width = 0.5) + \n  xlab(\"\") + ylab('RMSE for B') + scale_fill_brewer(palette=\"Set2\") + facet_grid(f ~ ., labeller = label_both)\nplot3 = ggplot(sdf, aes(x = fact, y = MSE_ab, fill = model )) +\n  geom_bar(stat = \"identity\", position = position_dodge(), color = 'grey40', width = 0.5) + \n  xlab(\"\") + ylab('RMSE for A&B') + scale_fill_brewer(palette=\"Set2\") + facet_grid(f ~ ., labeller = label_both)\nplot4 = ggplot(sdf, aes(x = fact, y = bias_a, fill = model )) +\n  geom_bar(stat = \"identity\", position = position_dodge(), color = 'grey40', width = 0.5) + \n  xlab(\"\") + ylab('bias_A') + scale_fill_brewer(palette=\"Set2\") + facet_grid(f ~ ., labeller = label_both)\nplot5 = ggplot(sdf, aes(x = fact, y = bias_b, fill = model )) +\n  geom_bar(stat = \"identity\", position = position_dodge(), color = 'grey40', width = 0.5) + \n  xlab(\"\") + ylab('bias_B') + scale_fill_brewer(palette=\"Set2\") + facet_grid(f ~ ., labeller = label_both)\nplot6 = ggplot(sdf, aes(x = fact, y = bias_ab, fill = model )) +\n  geom_bar(stat = \"identity\", position = position_dodge(), color = 'grey40', width = 0.5) + \n  xlab(\"\") + ylab('bias_AB') + scale_fill_brewer(palette=\"Set2\") + facet_grid(f ~ ., labeller = label_both)\nplot7 = ggplot(sdf, aes(x = fact, y = ESS, fill = model )) +\n  geom_bar(stat = \"identity\", position = position_dodge(), color = 'grey40', width = 0.5) + \n  xlab(\"\") + ylab('Expected sample size') + scale_fill_brewer(palette=\"Set2\") + facet_grid(f ~ ., labeller = label_both)\n\nload(\"extreme_results_1.RData\")\nsim_df$IF = NA\nsim_df$IF = sim_df$nb/5\nnames(sim_df)[names(sim_df) == \"p\"] = 'f'\n\np0 = ggplot(sim_df, aes(x = IF, color = model )) +\n  stat_ecdf(geom = 'line') + facet_grid(f ~ fact, labeller = labeller(f = label_both, fact = label_value)) + \n  scale_color_brewer(palette = 'Set2') + ylab(\"probability of trial termination for efficacy\")\n",
    "created" : 1506635332665.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4110204110",
    "id" : "26C3E385",
    "lastKnownWriteTime" : 1506963179,
    "last_content_update" : 1506963179264,
    "path" : "~/Dropbox/clinical_trials/additivity_paper/revision_run_extreme.R",
    "project_path" : null,
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}