{
    "collab_server" : "",
    "contents" : "M = 2000\n\nP_a = c(.35, .4)\nP_b = c(.4, .4)\np = c(.5, .5, .5, .75, .75, .75, 1, 1, 1)\npmean = p + c(rep(c(0, .25, -.25), 3))\n\ncases = cbind(rep(P_a, length(p)), expand.grid(P_b, p), rep(pmean, each = length(P_b)))\nnames(cases) = c('P_a', 'P_b', 'p', 'pmean')\n\n\nlibrary(parallel)\nsim0 = mcmapply(trial_add_fix_sim, P_a = cases$P_a, P_b = cases$P_b, p = cases$p, pmean0 = cases$pmean, \n              MoreArgs = list(PF_var = 1, np = 5, nadapt = 6, M = M, pvar = 0.16), mc.cores = 4)\n\nsim_df = cbind(unlist_df(t(sim0)), mefa:::rep.data.frame(cases, each = M))\nsim_df$model = rep(\"FA_unbiased\", nrow(sim_df))\nsim_df$model[sim_df$p < sim_df$pmean]  = \"FA_biased_p\"\nsim_df$model[sim_df$p > sim_df$pmean]  = \"FA_biased_n\"\nfact = paste('P_A', '=', sim_df$P_a, 'P_B', '=', sim_df$P_b)\nsim_df$fact = fact\nsim_df0 = sim_df\n#sim_df0$pmean = NULL\n\n# sdf = sim_df %>%\n#   group_by(fact, p, model) %>%\n#   summarise(EFP = mean(FP))\n# plot0 = ggplot(sdf, aes(x = fact, y = EFP, fill = model )) +\n#   geom_bar(stat = \"identity\", position = position_dodge(), color = 'grey40', width = 0.5) + \n#   xlab(\"\") + ylab('EPF') + scale_fill_brewer(palette=\"Set2\") + facet_grid(p ~ .)\n\n########################################################\n# P_a = c(.35, .4)\n# P_b = c(.4, .4)\n# p = c(.5, .75, 1)\n# \n# \n# cases = cbind(rep(P_a, length(p)), expand.grid(P_b, p))\n# names(cases) = c('P_a', 'P_b', 'p')\n\n#library(parallel)\nsim1 = mcmapply(trial_fix_full_sim, P_a = cases$P_a, P_b = cases$P_b, p = cases$p, pmean0 = cases$pmean,\n                MoreArgs = list(PF_var = 1, np = 5, nadapt = 6, M = M), mc.cores = 4)\n\nsim_df1 = cbind(unlist_df(t(sim1)), mefa:::rep.data.frame(cases, each = M))\nsim_df1$model = \"FullA\"\nfact = paste('P_A', '=', sim_df1$P_a, 'P_B', '=', sim_df1$P_b)\nsim_df1$fact = fact\n########################################\n# P_a = c(.35, .4)\n# P_b = c(.4, .4)\n# p = c(.5, .75, 1)\n# \n# cases = cbind(rep(P_a, length(p)), expand.grid(P_b, p))\n# names(cases) = c('P_a', 'P_b', 'p')\n\n#library(parallel)\nsim2 = mcmapply(trial_std_fix_sim, P_a = cases$P_a, P_b = cases$P_b, p = cases$p, pmean0 = cases$pmean,\n                MoreArgs = list(PF_var = 1, np = 5, nadapt = 6, M = M), mc.cores = 4)\n\nsim_df2 = cbind(unlist_df(t(sim2)), mefa:::rep.data.frame(cases, each = M))\nsim_df2$model = \"Conventional\"\nfact = paste('P_A', '=', sim_df2$P_a, 'P_B', '=', sim_df2$P_b)\nsim_df2$fact = fact\n\nsim_df = rbind(sim_df0, sim_df1, sim_df2)\nsave(sim_df, file = \"revised_results_fixed_1.RData\")\nload(\"revised_results_fixed_1.RData\")\n\nsdf = sim_df %>%\n  filter(batch != 5) %>%\n  group_by(fact, p, model) %>%\n  summarise(power = mean((pab>0.95)))\nnames(sdf)[names(sdf) == \"p\"] = \"f\"\nnames(sim_df)[names(sim_df) == \"p\"] = 'f'\nplot0 = ggplot(sdf, aes(x = fact, y = power, fill = model )) +\n  geom_bar(stat = \"identity\", position = position_dodge(), color = 'grey40', width = 0.5) + \n  xlab(\"\") + ylab('power') + scale_fill_brewer(palette=\"Set2\") + facet_grid(f ~ ., labeller = label_both)\n\nplot1 = ggplot(sim_df, aes(x = batch, y = pab, color = model)) +\n  stat_summary(fun.data=mean_cl_normal, position=position_dodge(0.5), geom=\"errorbar\") +\n  stat_summary(fun.y=mean,position=position_dodge(width=0.5),geom=\"point\") + \n  stat_summary(fun.y=mean,position=position_dodge(width=0.5),geom=\"line\") + \n  facet_grid(f ~ fact, labeller = labeller(f = label_both, fact = label_value)) + \n  xlab('') + ylab('P(A&B superior to A and B)') + \n  scale_color_brewer(palette = 'Set2')\n\nplot2 = ggplot(sim_df, aes(x = batch, y = pa, color = model)) +\n  stat_summary(fun.data=mean_cl_normal, position=position_dodge(0.5), geom=\"errorbar\") +\n  stat_summary(fun.y=mean,position=position_dodge(width=0.5),geom=\"point\") + \n  stat_summary(fun.y=mean,position=position_dodge(width=0.5),geom=\"line\") + \n  facet_grid(f ~ fact, labeller = labeller(f = label_both, fact = label_value)) + \n  xlab('') + ylab('P(A superior to B and A&B)') + \n  scale_color_brewer(palette = 'Set2')\n\nplot3 = ggplot(sim_df, aes(x = batch, y = pb, color = model)) +\n  stat_summary(fun.data=mean_cl_normal, position=position_dodge(0.5), geom=\"errorbar\") +\n  stat_summary(fun.y=mean,position=position_dodge(width=0.5),geom=\"point\") + \n  stat_summary(fun.y=mean,position=position_dodge(width=0.5),geom=\"line\") + \n  facet_grid(f ~ fact, labeller = labeller(f = label_both, fact = label_value)) + \n  xlab('') + ylab('P(B superior to A and A&B)') + \n  scale_color_brewer(palette = 'Set2')\n\n\n\n\n",
    "created" : 1505864716165.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3112246457",
    "id" : "760B230F",
    "lastKnownWriteTime" : 1506963386,
    "last_content_update" : 1506963387022,
    "path" : "~/Dropbox/clinical_trials/additivity_paper/revision_fixed_sample.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}